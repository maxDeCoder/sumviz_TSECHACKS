<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300&display=swap" rel="stylesheet"> -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <title>Home</title>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Work+Sans:400,600');

        mark {
            background-color: yellow;
            color: black;
        }

        body {
            margin: 0;
            background: #222;
            font-family: 'Work Sans', sans-serif;
            font-weight: 800;

        }

        .container {
            width: 80%;
            margin: 0 auto;
        }

        header {
            background: #55d6aa;

        }

        header::after {
            content: '';
            display: table;
            clear: both;
        }

        nav {
            float: right;
            display: flex;
        }

        nav ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        nav li {
            display: inline-block;
            margin-left: 70px;
            padding-top: 23px;
            padding: 30px;

            position: relative;
        }

        nav a {
            color: black;
            text-decoration: none;
            text-transform: uppercase;
            font-size: 14px;
        }

        nav a:hover {
            color: #000;
        }

        nav a::before {
            content: '';
            display: block;
            height: 5px;
            background-color: #444;
            position: absolute;
            top: 0;
            width: 0%;

            transition: all ease-in-out 250ms;
        }

        nav a:hover::before {
            width: 100%;
        }


        .text-editor-sec {
            display: "flex";
        }

        .text-editor-sec {
            display: flex;
            justify-content: space-between;
        }

        .editable_viewR {
            display: flex;
            width: 45%;
            height: 70vh;
            margin: auto;
            flex-direction: column;
            justify-content: space-between;
            background-color: white;
            margin-top: 30px;
            margin-right: 30px;
            margin-bottom: 60px;
            padding: 25px;
        }

        .editable_viewL {
            display: flex;
            width: 45vw;
            margin: auto;
            height: 77vh;
            flex-direction: column;
            justify-content: space-between;
            margin: 30px;
            padding: 0%;
            background-color: white;
        }

        .locked_input {
            display: flex;
            width: 100%;
            height: 100%;
            flex-direction: column;
            justify-content: space-between;
            margin: auto;
            padding: 0%;
            background-color: white;
            font-size: small;
            padding: 25px;
        }

        .button {
            border-radius: 4px;
            background-color: #1eb7f4;
            border: none;
            color: #FFFFFF;
            text-align: center;
            font-size: 28px;
            padding: 20px;
            width: 200px;
            transition: all 0.5s;
            cursor: pointer;
            /* margin: 5px; */
            border-radius: 20px;
            display: block;
            margin-left: 40%;
        }

        .button span {
            cursor: pointer;
            display: inline-block;
            position: relative;
            transition: 0.5s;
        }

        .button span:after {
            content: '\00bb';
            position: absolute;
            opacity: 0;
            top: 0;
            right: -20px;
            transition: 0.5s;
        }

        .button:hover span {
            padding-right: 25px;
        }

        .button:hover span:after {
            opacity: 1;
            right: 0;
        }

        .hundred {
            width: 100vw;
            display: flex;
            margin: auto;
            justify-content: space-between;
            padding-bottom: 5vh;
        }

        .three-button {
            width: 100vw;
            flex-direction: row;
            display: flex;
            justify-content: space-evenly;
            margin: auto;
            /* transition: all 0.5s; */
            cursor: pointer;

        }

        .fifty-percent {
            width: 50vw;
            flex-direction: row;
            display: flex;
            justify-content: space-evenly;
            margin: auto;
        }

        .summary {
            display: flex;
            background-color: #92F183;
            width: 96vw;
            height: auto;
            border-radius: 30px;
            margin-top: 30px;
            margin-bottom: 30px;
            text-align: center;
            justify-content: center;
            padding: 20px;
        }

        .navbar {
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px 10vw;
            display: flex;
            justify-content: space-between;
            padding-left: 0%;
            height: 100px;
            z-index: 9;
            margin-left: 0px;
        }

        .nav {
            padding: 10px 10vw;
            display: flex;
            justify-content: left;
            padding-left: 0%;
        }

        .brand-logo {
            height: 100px;
            float: left;
        }

        #footer {
            background: black;
            padding: 0 0 30px 0;
            color: #fff;
            font-size: 14px;
        }

        #footer .footer-top {
            background: #0c0b09;
            border-top: 1px solid #37332a;
            border-bottom: 1px solid #28251f;
            padding: 60px 0 30px 0;
        }

        #footer .footer-top .footer-info {
            margin-bottom: 30px;
        }

        #footer .footer-top .footer-info h3 {
            font-size: 24px;
            margin: 0 0 20px 0;
            padding: 2px 0 2px 0;
            line-height: 1;
            font-weight: 300;
            text-transform: uppercase;
            font-family: "Poppins", sans-serif;
        }

        #footer .footer-top .footer-info p {
            font-size: 14px;
            line-height: 24px;
            margin-bottom: 0;
            font-family: "Poppins", sans-serif;
            color: #fff;
        }

        #footer .footer-top .social-links a {
            font-size: 18px;
            display: inline-block;
            background: #28251f;
            color: #fff;
            line-height: 1;
            padding: 8px 0;
            margin-right: 4px;
            border-radius: 50%;
            text-align: center;
            width: 36px;
            height: 36px;
            transition: 0.3s;
        }

        #footer .footer-top .social-links a:hover {
            background: #b11c1c;
            color: #fff;
            text-decoration: none;
        }

        #footer .footer-top h4 {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            position: relative;
            padding-bottom: 12px;
        }

        #footer .footer-top .footer-links {
            margin-bottom: 30px;
        }

        #footer .footer-top .footer-links ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #footer .footer-top .footer-links ul i {
            padding-right: 2px;
            color: #b11c1c;
            font-size: 18px;
            line-height: 1;
        }

        #footer .footer-top .footer-links ul li {
            padding: 10px 0;
            display: flex;
            align-items: center;
        }

        #footer .footer-top .footer-links ul li:first-child {
            padding-top: 0;
        }

        #footer .footer-top .footer-links ul a {
            color: rgb(255, 0, 0);
            transition: 0.3s;
            display: inline-block;
            line-height: 1;
        }

        #footer .footer-top .footer-links ul a:hover {
            color: #000000;
        }

        #footer .footer-top .footer-newsletter form {
            margin-top: 30px;
            background: #28251f;
            padding: 6px 10px;
            position: relative;
            border-radius: 50px;
            border: 1px solid #ffffff;
        }

        #footer .footer-top .footer-newsletter form input[type=email] {
            border: 0;
            padding: 4px;
            width: calc(100% - 110px);
            background: #28251f;
            color: white;
        }

        #footer .footer-top .footer-newsletter form input[type=submit] {
            position: absolute;
            top: -1px;
            right: -1px;
            bottom: -1px;
            border: 0;
            background: none;
            font-size: 16px;
            padding: 0 20px 2px 20px;
            background: #b11c1c;
            color: rgb(255, 0, 0);
            transition: 0.3s;
            border-radius: 50px;
        }

        #footer .footer-top .footer-newsletter form input[type=submit]:hover {
            background: #b11c1c;
        }

        #footer .copyright {
            text-align: center;
            padding-top: 30px;
        }

        #footer .credits {
            padding-top: 10px;
            text-align: center;
            font-size: 13px;
            color: #b11c1c;
        }

        .class-hover:hover {
            color: red;
        }

        .copyright-names {
            color: white;
        }
        
        .line_al{
            display:flex;
            justify-content: space-between;
        }

        .name{
            width: 50px;
            height: 50px;
        }

        .brandnav{
            display: flex;
            align-items: center;
            font-size: 50px;
        }
    </style>
</head>

<body>
    <header>
        <div class="navbar">
            <div class="brandnav">
                <img src="https://cdn.discordapp.com/attachments/950975761228111894/951242173033091092/logo_prev_ui_1.png"
                    class="brand-logo" alt="">
                <div class="name">
                    Sumwiz
                </div>
            </div>

            <div>
                <nav>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#graph">Visualize text</a></li>
                        <li><a href="#sum">Summarize text</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    <!--Main-->
    <section>
        <div class="text-editor-sec">
            <div class="editable_viewL col-sm-6" style="overflow-y: scroll;">
                <textarea id="text_input" rows="34" cols="100" name="description"
                    class="text-editor">Enter the text</textarea>
                <p id="P_input" class="text-editor"></p>
            </div>
            <div id="graph" class="editable_viewR col-sm-6 text-editor">
            </div>
        </div>
    </section>

    <div class="hundred">
        <div class="three-button">
            <button class="button" onclick="highlight_section('INTRODUCTION')"><span>Introduction</span></button>
            <button class="button" onclick="highlight_section('BODY')"><span>Body</span></button>
            <button class="button" onclick="highlight_section('CONCLUSION')"><span>Conclusion</span></button>
        </div>
        <div class="fifty-percent">

        </div>
    </div>

    <section class="gen_button">
        <div class="container col-sm-12">
            <div class="anim line_al">
                <!--Butto generate-->
                <div style="margin-left:100px ;">
                    <button class="button" onclick="query()"><span>Analyze</span></button>
                </div>
                <div style="margin-right: 300px;">
                    <button class="button" onclick="reset_input()"><span>Reset</span></button>
                </div>
            </div>
        </div>
    </section>

    <div id="sum" class="summary">
        <h3><b>Summary:</b></h3>
        <p id="summary"></p>

    </div>
    <span id="follow us">
        <footer id="footer">

            <div class="container">
                <div class="copyright">
                    Developed By : <strong><span><a class="class-hover copyright-names"
                                href="https://www.linkedin.com/in/nidhi-kashyap-9a5b7922a/" target="_blank">Nidhi
                            </a>| <a class="class-hover copyright-names"
                                href="https://www.linkedin.com/in/virenkeswani/" target="_blank">Viren</a> | <a
                                class="class-hover copyright-names"
                                href="https://www.linkedin.com/in/aditya-shah-139154208/" target="_blank">Aditya</a> |
                            <a class="class-hover copyright-names" href="https://www.linkedin.com/in/vedantjumle/"
                                target="_blank">Vedant</a></span></strong>
                </div>
            </div>
        </footer>
    </span>
</body>
<script>
    is_locked = false;
    summary = ""
    nodes = {}
    sections = {}
    enitities = []
    num_parent_nodes = 0
    function clear_graph() {
        document.getElementById("graph").innerHTML = "";
    }
    async function query() {
        clear_graph()
        lock_input()
        text = document.getElementById("text_input").value;
        res = await fetch(`/process?text=${text}`, {
            headers: {
                "Content-Type": "application/json"
            },
        });

        data = await res.json();
        console.log(data);
        summary = data.summary;
        sections = data.sections;
        enitities = data.entities;

        build_graph()
        updateSummary(summary, enitities)
    }

    function lock_input() {
        is_locked = true;
        document.getElementById("P_input").innerText = document.getElementById("text_input").value.replace(/(\r\n|\n|\r)/gm, "");
        document.getElementById("text_input").style.display = "none";
    }

    function reset_input() {
        is_locked = false;
        document.getElementById("P_input").innerText = ""
        document.getElementById("text_input").style.display = "block";
        document.getElementById("text_input").value = "";
        resetHighlights()
        clear_graph()
    }

    // update the summary element with the summary and hyperlink the salient words such that they do a google search
    function updateSummary(summary, salient_words) {
        var summary_element = document.getElementById("summary");
        summary_element.innerHTML = summary;
        // create hyperlinks in the summary for words in salient_words such that they do google search
        for (var i = 0; i < salient_words.length; i++) {
            var word = salient_words[i];
            var regex = new RegExp(word, "g");
            summary_element.innerHTML = summary_element.innerHTML.replace(regex, `<a href='https://www.google.com/search?q=${word}' target='_blank'>${word}</a>`);
        }
    }

    function highlight_section(section_name) {
        if (is_locked) {
            for (let i = 0; i < sections.length; i++) {
                if (sections[i].type == section_name) {
                    console.log(sections[i].start, sections[i].end)
                    highlight(sections[i].start, sections[i].end)
                    break
                }
            }
        } else {
            alert("Please click the analyze button first")
        }
    }

    function resetHighlights(){
        para = document.getElementById("P_input");
        para.innerHTML = para.innerHTML.replace("<mark>", "")   
        para.innerHTML = para.innerHTML.replace("</mark>", "")
    }

    function highlight(start_char, end_char, type="section") {
        // clear previous highglight
        if (is_locked) {
            para = document.getElementById("P_input");
            
            if (type == "section"){resetHighlights()}

            // insert <mark> at start_char and </mark> at end_char
            para.innerHTML = para.innerHTML.substring(0, start_char) + "<mark>" + para.innerHTML.substring(start_char, end_char) + "</mark>" + para.innerHTML.substring(end_char);
        } else {
            alert("Please click the analyze button first")
        }
    }

    function build_graph() {
        var canvas = d3.select(".editable_viewR").append("svg")
            .attr("width", 700)
            .attr("height", 700)
            .call(d3.zoom().on("zoom", function () {
                canvas.attr("transform", d3.event.transform)
            }))
            .append("g")
            .attr("transform", "translate(0,0)")
            .attr("zoom", "0.1")


        var tree = d3.tree()
            .size([400, 400]);

        d3.json("tree", function (err, data) {
            console.log(data)

            // set number parent nodes
            num_parent_nodes = data.children.length;

            var nodes = tree(d3.hierarchy(data));
            var links = nodes.links();

            var node = canvas.selectAll(".node")
                .data(nodes.descendants())
                .enter()
                .append("g")
                .attr("class", "node")
                .attr("transform", function (d) {
                    return "translate(" + d.y * 2 + "," + d.x * 0.2 * num_parent_nodes + ")";
                });
            //action on selecting a circle only for one entity  

            test = "This page shares my best articles to read on topics like health, happiness, creativity, productivity and more. The central question that drives my work is, “How can we live better?” To answer that question, I like to write about science-based ways to solve practical problems. You’ll find interesting articles to read on topics like how to stop procrastinating as well as personal recommendations like my list of the best books to read and my minimalist travel guide. Ready to dive in? You can use the categories below to browse my best articles."

            node.append("circle")
                .attr("r", d => {
                    if (d.data.data.type == "ref") {
                        return 5;
                    } else { return 20 }
                })
                .attr("fill", d => {
                    if (d.data.data.type == "obj") {
                        return "#ffcc66"
                    } else if (d.data.data.type == "root" || d.data.data.type == "ref") {
                        return "steelblue"
                    } else {
                        return "#dd99ff"
                    }
                });



            node.append("text")
                .text(function (d) {
                    //console.log(d);
                    return d.data.data.sub;
                })
                .attr("dy", d => {
                    offset = "-1.5em";
                    if (d.data.data.type == "root") { }
                })
                .attr("dx", d => {
                    size = "-3em";
                    if (d.data.data.type == "root") { size = "-5em" }
                    else if (d.data.data.type == "ref") { size = "0em" }
                    else if (d.data.data.type == "obj") { return "1.5em" }
                    return size
                })
                .attr("font-style", "bold")
                .attr("font-size", d => {
                    if (d.data.data.type == "ref") {
                        return "14px";
                    } else { return "16px" }
                })

            var diagonal = d3.linkVertical()
                .x(function (d) { return d.y * 2 })
                .y(function (d) { return d.x * 0.2 * num_parent_nodes })


            canvas.selectAll(".link")
                .data(links)
                .enter()
                .append("path")
                .attr("class", "link")
                .attr("fill", "none")
                .attr("stroke", "#ccc")
                .attr("d", diagonal);


        })
    }
</script>

</html>